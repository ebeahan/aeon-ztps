# this file was auto-generated by the aeon-ztps installation process

ddns-update-style none;
default-lease-time 7200;
max-lease-time 7200;
authoritative;
log-facility local7;

{% set ztps_address = interfaces['eth0'].address | ipaddr('address') %}

# The specific settings for Cumulus ONIE process
option cumulus-provision-url code 239 = text;

# this default-url *MUST* be in the global area for ONIE to
# work properly.  Not sure why this is, but it is.

option default-url = "http://{{ ztps_address }}:8080/images/cumulus/onie-installer";

class "cumulus-switch" {
   match if (substring(option host-name, 0, 7) = "cumulus");
   option cumulus-provision-url "http://{{ ztps_address }}:8080/downloads/ztp-cumulus.sh";
}

class "eos-switch" {
   match if (substring(option vendor-class-identifier, 0, 6) = "Arista");
   option bootfile-name "tftp://{{ DHCPS_tftpserver }}/ztp-eos.sh";
}

class "nxos-switch" {
   match if (substring(option vendor-class-identifier, 0, 5) = "Cisco");
   option tftp-server-name "{{ DHCPS_tftpserver }}";
   option bootfile-name "ztp-nxos.py";
}

{% for scope in DHCPS_scopes %}
{% set dhcp_cidr = "%s/%s" % (scope.network, scope.netmask) %}
{% set dhcp_lease_start = dhcp_cidr | ipaddr(scope.range_start_offset) | ipaddr('address') %}
{% set dhcp_lease_end = dhcp_cidr | ipaddr(scope.range_end_offset) | ipaddr('address')  %}
{% set dhcp_gateway = scope.gateway | default(None) %}
{% set dhcp_nameserver = scope.nameserver|default(None) or DHCPS_nameserver|default(None) %}

subnet {{ scope.network }} netmask {{ scope.netmask }} {
   range {{ dhcp_lease_start }} {{ dhcp_lease_end }};
{% if dhcp_gateway  %}
   option routers {{ dhcp_gateway }};
{% endif %}
{% if dhcp_nameserver %}
   option domain-name-servers {{ dhcp_nameserver }};
{% endif %}
}
{% endfor %}